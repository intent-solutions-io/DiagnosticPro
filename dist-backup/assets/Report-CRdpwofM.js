const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/firebase-CH45w-dM.js","assets/firebase-YPPaOoNU.js"])))=>i.map(i=>d[i]);
import{A as P,B as R,n as E,D as I,o as A,F as T,p as C,q as F,G as k,Q as L,s as V,S as B,T as z,V as O,t as U,u as H,v as M,w as q,x as Y,y as G,z as K,E as Q,H as W,l as $,I as J,J as Z,K as X,L as ee,d as te}from"./firebase-YPPaOoNU.js";import{c as se,_ as b,v as ae,r as p,j as e,R as j,B as _}from"./index-Cb9AmbZ7.js";import{C as re,d as oe,e as ne,a as ie,B as f,b as ce,c as de}from"./card-BIPM_yue.js";import{u as le,D as ue,C as v}from"./use-toast-BIVZfLPF.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=se("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),N=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:P,Bytes:R,CollectionReference:E,DocumentReference:I,DocumentSnapshot:A,FieldPath:T,Firestore:C,FirestoreError:F,GeoPoint:k,Query:L,QueryDocumentSnapshot:V,SnapshotMetadata:B,Timestamp:z,VectorValue:O,_AutoId:U,_ByteString:H,_DatabaseId:M,_DocumentKey:q,_EmptyAuthCredentialsProvider:Y,_FieldPath:G,_cast:K,_logWarn:Q,_validateIsNotUsedTogether:W,collection:$,connectFirestoreEmulator:J,doc:Z,ensureFirestoreConfigured:X,getDoc:ee,getFirestore:te},Symbol.toStringTag,{value:"Module"}));async function ge(a){try{const{db:t}=await b(async()=>{const{db:c}=await import("./firebase-CH45w-dM.js");return{db:c}},__vite__mapDeps([0,1])),{doc:o,getDoc:n}=await b(async()=>{const{doc:c,getDoc:h}=await Promise.resolve().then(()=>N);return{doc:c,getDoc:h}},void 0),r=o(t,"diagnosticSubmissions",a),s=await n(r);if(!s.exists())throw new Error("Diagnostic submission not found");const i=s.data();if(!i.downloadUrl)throw new Error("Download URL not available - report may still be processing");window.location.href=i.downloadUrl}catch(t){throw console.error("Error downloading report:",t),t}}async function D(a){var t,o,n,r,s,i;try{const{db:c}=await b(async()=>{const{db:y}=await import("./firebase-CH45w-dM.js");return{db:y}},__vite__mapDeps([0,1])),{doc:h,getDoc:m}=await b(async()=>{const{doc:y,getDoc:g}=await Promise.resolve().then(()=>N);return{doc:y,getDoc:g}},void 0),x=h(c,"diagnosticSubmissions",a),w=await m(x);if(!w.exists())return{data:null,status:404,error:"Diagnostic submission not found"};const u=w.data();return{data:{id:a,status:u.analysisStatus==="completed"?"ready":u.analysisStatus==="processing"?"processing":u.analysisStatus==="failed"?"failed":"pending",gcsPath:u.reportPath,createdAt:((n=(o=(t=u.createdAt)==null?void 0:t.toDate)==null?void 0:o.call(t))==null?void 0:n.toISOString())||u.createdAt,updatedAt:((i=(s=(r=u.analysisCompletedAt)==null?void 0:r.toDate)==null?void 0:s.call(r))==null?void 0:i.toISOString())||u.updatedAt},status:200}}catch(c){return console.error("Error getting diagnostic status from Firestore:",c),{data:null,status:500,error:`Failed to get diagnostic status: ${c instanceof Error?c.message:"Unknown error"}`}}}async function he(a,t,o=60,n=5e3){let r=0;for(;r<o;)try{const s=await D(a);if(s.data&&(t==null||t(s.data),s.data.status==="ready"||s.data.status==="failed"))return s.data;await new Promise(i=>setTimeout(i,n)),r++}catch(s){console.error("Error polling diagnostic status:",s),r++,await new Promise(i=>setTimeout(i,n))}return null}const ye=()=>{const{reportId:a}=ae(),[t,o]=p.useState(null),[n,r]=p.useState(!0),[s,i]=p.useState(!1),[c,h]=p.useState(!1),{toast:m}=le();p.useEffect(()=>{(async()=>{if(!a){r(!1);return}try{const l=await D(a);l.data?(o(l.data),(l.data.status==="processing"||l.data.status==="pending")&&x(a)):(console.error("Diagnostic not found"),o(null))}catch(l){console.error("Error fetching diagnostic status:",l),o(null)}finally{r(!1)}})()},[a]);const x=async d=>{if(!s){i(!0);try{const l=await he(d,S=>{o(S)},60,5e3);l?l.status==="ready"&&m({title:"Report Ready!",description:"Your diagnostic report is now ready for download."}):m({title:"Polling Timeout",description:"Status check timed out. Please refresh to check again.",variant:"destructive"})}catch(l){console.error("Error polling diagnostic status:",l),m({title:"Status Check Failed",description:"Unable to check diagnostic status. Please refresh.",variant:"destructive"})}finally{i(!1)}}},w=async()=>{if(a){h(!0);try{await ge(a),m({title:"Download Started",description:"Your report download should begin shortly."})}catch(d){console.error("Error downloading report:",d),m({title:"Download Failed",description:"Unable to download report. Please try again.",variant:"destructive"})}finally{h(!1)}}},u=async()=>{if(a){r(!0);try{const d=await D(a);d.data&&(o(d.data),(d.data.status==="processing"||d.data.status==="pending")&&x(a))}catch(d){console.error("Error refreshing status:",d),m({title:"Refresh Failed",description:"Unable to refresh status. Please try again.",variant:"destructive"})}finally{r(!1)}}},g=(()=>{if(!t)return{icon:e.jsx(v,{className:"h-8 w-8 text-red-500"}),title:"Report Not Found",description:"The requested diagnostic report could not be found.",badge:e.jsx(f,{variant:"destructive",children:"Not Found"}),canDownload:!1};switch(t.status){case"ready":return{icon:e.jsx(de,{className:"h-8 w-8 text-green-500"}),title:"Report Ready",description:"Your diagnostic report is ready for download.",badge:e.jsx(f,{className:"bg-green-500/10 text-green-600 border-green-200",children:"Ready"}),canDownload:!0};case"processing":return{icon:e.jsx(j,{className:"h-8 w-8 text-blue-500 animate-spin"}),title:"Generating Report",description:"Your diagnostic report is being generated. This usually takes 2-3 minutes.",badge:e.jsx(f,{className:"bg-blue-500/10 text-blue-600 border-blue-200",children:"Processing"}),canDownload:!1};case"failed":return{icon:e.jsx(v,{className:"h-8 w-8 text-red-500"}),title:"Generation Failed",description:"Report generation failed. Please contact support for assistance.",badge:e.jsx(f,{variant:"destructive",children:"Failed"}),canDownload:!1};case"pending":default:return{icon:e.jsx(ce,{className:"h-8 w-8 text-muted-foreground"}),title:"Report Pending",description:"Your diagnostic report is queued for generation.",badge:e.jsx(f,{variant:"secondary",children:"Pending"}),canDownload:!1}}})();return n?e.jsx("div",{className:"container mx-auto px-4 py-12",children:e.jsxs("div",{className:"max-w-2xl mx-auto text-center",children:[e.jsx(j,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4 animate-spin"}),e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Loading Report..."}),e.jsx("p",{className:"text-muted-foreground",children:"Checking report status..."})]})}):e.jsx("div",{className:"container mx-auto px-4 py-12",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:g.icon}),e.jsx("div",{className:"flex items-center justify-center mb-4",children:g.badge}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-4",children:g.title}),e.jsx("p",{className:"text-lg text-muted-foreground",children:g.description})]}),e.jsxs(re,{className:"mb-8",children:[e.jsx(oe,{children:e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5"}),"Diagnostic Report"]})}),e.jsx(ie,{children:t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Report ID:"}),e.jsx("p",{className:"font-mono text-muted-foreground",children:t.id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx("p",{className:"capitalize",children:t.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Created:"}),e.jsx("p",{children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Updated:"}),e.jsx("p",{children:new Date(t.updatedAt).toLocaleDateString()})]})]}),t.gcsPath&&e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Storage Location:"}),e.jsx("p",{className:"text-sm font-mono text-muted-foreground",children:t.gcsPath})]}),(t.status==="processing"||t.status==="pending")&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Processing Time:"})," Typically 2-3 minutes for comprehensive analysis."]}),s&&e.jsx("p",{className:"text-sm text-blue-600 mt-2",children:"ðŸ”„ Automatically checking for updates..."})]})]})})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs(_,{onClick:u,variant:"outline",size:"lg",disabled:n||s,children:[e.jsx(j,{className:`h-4 w-4 mr-2 ${n||s?"animate-spin":""}`}),n||s?"Updating...":"Refresh Status"]}),g.canDownload&&e.jsxs(_,{onClick:w,size:"lg",disabled:c,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),c?"Downloading...":"Download Report"]}),e.jsx(_,{onClick:()=>window.location.href="/",variant:"outline",size:"lg",children:"Return to Home"})]})]})})};export{ye as default};
