swagger: '2.0'
info:
  title: DiagnosticPro API Complete
  version: 1.0.4
host: diagpro-gw-3tbssksx-3tbssksx.uc.gateway.dev
schemes:
  - https
x-google-backend:
  address: https://diagnosticpro-vertex-ai-backend-298932670545.us-central1.run.app
  deadline: 60.0
paths:
  # Health check
  /healthz:
    get:
      operationId: healthCheck
      produces:
        - application/json
      responses:
        200:
          description: Service healthy
    options:
      operationId: healthCheckOptions
      responses:
        200:
          description: CORS preflight

  # Save submission (if needed via API)
  /saveSubmission:
    post:
      operationId: saveSubmission
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          schema:
            type: object
      responses:
        200:
          description: Submission saved
    options:
      operationId: saveSubmissionOptions
      responses:
        200:
          description: CORS preflight

  # Create checkout session
  /createCheckoutSession:
    post:
      operationId: createCheckoutSession
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          schema:
            type: object
      responses:
        200:
          description: Session created
    options:
      operationId: createCheckoutOptions
      responses:
        200:
          description: CORS preflight

  # Session retrieval
  /checkout/session:
    get:
      operationId: getCheckoutSession
      produces:
        - application/json
      parameters:
        - name: id
          in: query
          type: string
          required: true
      responses:
        200:
          description: Session retrieved
    options:
      operationId: checkoutSessionOptions
      responses:
        200:
          description: CORS preflight

  # AI Analysis - THE MISSING CRITICAL ENDPOINT
  /analyzeDiagnostic:
    post:
      operationId: analyzeDiagnostic
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          schema:
            type: object
            properties:
              submissionId:
                type: string
      responses:
        200:
          description: Analysis started
        400:
          description: Invalid submission
        500:
          description: Analysis failed
    options:
      operationId: analyzeDiagnosticOptions
      responses:
        200:
          description: CORS preflight

  # Analysis status
  /analysisStatus:
    post:
      operationId: analysisStatus
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          schema:
            type: object
      responses:
        200:
          description: Status retrieved
    options:
      operationId: analysisStatusOptions
      responses:
        200:
          description: CORS preflight

  # Reports signed URL (for PDF download)
  /reports/signed-url:
    get:
      operationId: getReportSignedUrl
      produces:
        - application/json
      parameters:
        - name: submissionId
          in: query
          type: string
          required: true
      responses:
        200:
          description: Download URL generated
    options:
      operationId: reportsSignedUrlOptions
      responses:
        200:
          description: CORS preflight

  # Reports status
  /reports/status:
    get:
      operationId: getReportStatus
      produces:
        - application/json
      parameters:
        - name: submissionId
          in: query
          type: string
          required: true
      responses:
        200:
          description: Report status
    options:
      operationId: reportsStatusOptions
      responses:
        200:
          description: CORS preflight

  # Reports ensure (generate if missing)
  /reports/ensure:
    post:
      operationId: ensureReport
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          schema:
            type: object
      responses:
        200:
          description: Report ensured
    options:
      operationId: ensureReportOptions
      responses:
        200:
          description: CORS preflight

  # Direct PDF view URL
  /view/{submissionId}:
    get:
      operationId: viewReport
      produces:
        - application/pdf
      parameters:
        - name: submissionId
          in: path
          type: string
          required: true
      responses:
        200:
          description: PDF report
        302:
          description: Redirect to signed URL
        404:
          description: Report not found
    options:
      operationId: viewReportOptions
      responses:
        200:
          description: CORS preflight

  # Download URL (legacy)
  /getDownloadUrl:
    post:
      operationId: getDownloadUrl
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          schema:
            type: object
      responses:
        200:
          description: Download URL
    options:
      operationId: getDownloadUrlOptions
      responses:
        200:
          description: CORS preflight